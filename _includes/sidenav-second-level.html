{% comment %}
  the category and folder name is obtained directly from page.id
{% endcomment %}
{%- assign collection = page.collection -%}
{%- assign sub_collection = page.id | split: "/" | shift | shift | first -%}
{%- assign current_category = page.id | split: "/" | shift | shift | shift | first -%}
{%- assign folder_name = page.id | split: "/" | shift | shift | shift | shift | first -%}

{%- assign active_page = page.id | split: "/" | last -%}

{% comment %}
  we obtain the _data variable from the front matter of the page so that this sidenav single level can be generic
{% endcomment %}
{%- assign sub_collections = site.data[page._data] -%}
{%- for sub_collection in sub_collections -%}
  {% assign collection_name = sub_collection.name | slugify %}
  {%- if collection_name == folder_name -%}
    {%- assign current_collection = sub_collection-%}
  {% endif %}
{% endfor %}

{%- assign nav_items = current_collection.items -%}

{% for first_level_item in nav_items %}
  {%- assign class = nil -%}
  {%- assign should_render_dropdown = first_level_item.dropdown -%}
  {%- assign item_url = first_level_item.sub_item_name | slugify -%}
  {%- if active_page == item_url -%}
    {%- assign class = 'is-active' -%}
  {%- endif -%}

  {%- if should_render_dropdown -%}
    {% assign href = "#!" %}
    {% assign icon_class = "sgds-icon-chevron-down" %}
    {% assign label= first_level_item.sub_item_name %}
    {% assign hide_nav_section = 'is-hidden' %}
    {%- assign first_lvl_nav_item_slug = first_level_item.name | slugify -%}

    {% if page.url contains first_lvl_nav_item_slug  %}
      {% assign hide_nav_section = nil %}
      {% assign icon_class = "sgds-icon-chevron-up" %}
    {% endif %}

    {% include sidenav-first-lvl-nav-item.html label=label href=href icon_class=icon_class class=class %}
    <ul class="second-level-nav-div {{ hide_nav_section }}">
      {%- for second_lvl_nav_item in first_level_item.sub_item_item -%}
      {% comment %}
      Compare page's id (file path without .html extension) to each link to see if page is active.
      {% endcomment %}
      {%- assign second_lvl_nav_item_slug = second_lvl_nav_item | slugify -%}

      {%- assign class = nil -%}
      {%- if (page_id_last == second_lvl_nav_item_slug and page.url contains first_lvl_nav_item_slug) -%}
        {%- assign class = 'is-active' -%}
      {%- endif -%}

      {%- assign sidenav_item_url = item_url | append : '/'| append: second_lvl_nav_item_slug -%}
      {% include sidenav-second-lvl-nav-item.html label=second_lvl_nav_item href=second_lvl_nav_item_slug class=class %}
    {%- endfor -%}
  </ul>
  {%- else -%}
    {% assign label= first_level_item.sub_item_name %}
    {% assign icon_class = first_level_item.icon_class %}
    {% include sidenav-first-lvl-nav-item.html label=label href=item_url icon_class=icon_class class=class %}
  {%- endif -%}
{% endfor %}